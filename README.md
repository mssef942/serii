# Отчет по базе данных туристического агентства

## Общая информация
- Версия PostgreSQL: 15.3
- Дата создания отчета: 2025-05-21
- Количество таблиц: 6 основных таблиц
- Количество представлений: 1
- Количество функций: 7
- Количество триггеров: 4

## Структура базы данных

### Основные таблицы

1. **clients** - Клиенты
   - Поля: id, birthdate, phone, name, email, visible
   - Количество записей: 5
   - Первичный ключ: id
   - Триггер: tr_log_client_changes (логирует изменения)
   - Правило: delete_clients (скрывает вместо удаления)

2. **tours** - Туры
   - Поля: id_tour, descrition, startdate, EndDate
   - Количество записей: 5
   - Первичный ключ: id_tour

3. **empoyees** - Сотрудники (ошибка в названии таблицы - должно быть "employees")
   - Поля: id_employees, FullName, Position, Email
   - Количество записей: 5
   - Первичный ключ: id_employees

4. **soldtrips** - Проданные туры
   - Поля: id_sold_trip, saledate, TotalCost, PaymentsValue, id_client, id_tour
   - Количество записей: 5
   - Первичный ключ: id_sold_trip
   - Триггер: tr_update_tour_status (обновляет статус тура)

5. **salesoperations** - Операции продаж
   - Поля: id_operation, OperationDate, Note, id_sold_trip, id_employee
   - Количество записей: 5
   - Первичный ключ: id_operation
   - Триггеры: 
     - tr_validate_employee_commission (проверяет комиссию)
     - tr_validate_sale_date (проверяет дату продажи)

6. **clients_audit** - Аудит изменений клиентов
   - Поля: audit_id, operation, client_id, changed_by, change_time, old_data, new_data
   - Пока пустая таблица

### Представления

1. **clientsi** - Видимое представление клиентов (фильтрует по visible=true)

## Функции

1. **clientphone()** - возвращает email клиентов (название не соответствует функционалу)
2. **log_client_changes()** - логирует изменения в таблице клиентов
3. **soldsale()** - возвращает даты продаж
4. **toursdate()** - возвращает описания туров (название не соответствует функционалу)
5. **update_tour_status()** - обновляет статус тура на "Продан"
6. **validate_employee_commission()** - проверяет комиссию сотрудника (не более 10% от стоимости тура)
7. **validate_sale_date()** - проверяет, что продажа оформлена минимум за 3 дня до начала тура

## Триггеры

1. **tr_log_client_changes** - логирует изменения в таблице клиентов
2. **tr_update_tour_status** - обновляет статус тура при продаже
3. **tr_validate_employee_commission** - валидирует комиссию сотрудника
4. **tr_validate_sale_date** - проверяет дату продажи относительно даты тура

## Анализ данных

### Клиенты
В базе содержится информация о 5 клиентах, родившихся в период с 2000 по 2015 годы. Используются различные почтовые сервисы (mail.ru, rambler.ru, gmail.com).

### Туры
Имеется 5 туров с различными датами (с 2001 по 2025 год) и описаниями ("понравилось", "не очень", "хорошо", "круто", "ок").

### Сотрудники
Зарегистрировано 5 сотрудников с различными должностями (указаны цифрами, что не информативно).

### Продажи
Зафиксировано 5 продаж туров с разной стоимостью (от 4500 до 15000 рублей). Все суммы указаны в рублях.

### Операции продаж
Записано 5 операций с оценками от "очень не круто" до "круто".
